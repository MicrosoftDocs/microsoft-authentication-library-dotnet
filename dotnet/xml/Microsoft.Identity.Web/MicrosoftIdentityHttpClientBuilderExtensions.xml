<Type Name="MicrosoftIdentityHttpClientBuilderExtensions" FullName="Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions">
  <TypeSignature Language="C#" Value="public static class MicrosoftIdentityHttpClientBuilderExtensions" />
  <TypeSignature Language="ILAsm" Value=".class public auto ansi abstract sealed beforefieldinit MicrosoftIdentityHttpClientBuilderExtensions extends System.Object" />
  <TypeSignature Language="DocId" Value="T:Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions" />
  <TypeSignature Language="VB.NET" Value="Public Module MicrosoftIdentityHttpClientBuilderExtensions" />
  <TypeSignature Language="F#" Value="type MicrosoftIdentityHttpClientBuilderExtensions = class" />
  <AssemblyInfo>
    <AssemblyName>Microsoft.Identity.Web.TokenAcquisition</AssemblyName>
    <AssemblyVersion>4.2.0.0</AssemblyVersion>
    <AssemblyVersion>4.3.0.0</AssemblyVersion>
  </AssemblyInfo>
  <Base>
    <BaseTypeName>System.Object</BaseTypeName>
  </Base>
  <Interfaces />
  <Attributes>
    <Attribute>
      <AttributeName Language="C#">[System.Runtime.CompilerServices.Nullable(0)]</AttributeName>
      <AttributeName Language="F#">[&lt;System.Runtime.CompilerServices.Nullable(0)&gt;]</AttributeName>
    </Attribute>
  </Attributes>
  <Docs>
    <summary>
            Extension methods for <see cref="T:Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" /> to add <see cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandler" />
            to the HTTP client pipeline with various configuration options.
            </summary>
    <remarks>
      <para>
            These extension methods provide a convenient way to configure HttpClient instances with automatic
            Microsoft Identity authentication using <see cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandler" />. The handler
            will automatically add authorization headers to outgoing HTTP requests based on the configured options.
            </para>
      <para>
            Four overloads are provided to support different configuration scenarios:
            </para>
      <list type="bullet">
        <item>
          <description>Parameterless: For scenarios where options are set per-request</description>
        </item>
        <item>
          <description>Options instance: For programmatic configuration with a pre-built options object</description>
        </item>
        <item>
          <description>Action delegate: For inline configuration using a configuration delegate</description>
        </item>
        <item>
          <description>IConfiguration: For configuration from appsettings.json or other configuration sources</description>
        </item>
      </list>
    </remarks>
    <altmember cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions" />
    <altmember cref="T:Microsoft.Identity.Web.HttpRequestMessageAuthenticationExtensions" />
    <example>
      <para>
        <strong>Basic usage with inline configuration:</strong>
      </para>
      <code>
            services.AddHttpClient("MyApiClient", client =&gt;
            {
                client.BaseAddress = new Uri("https://api.example.com");
            })
            .AddMicrosoftIdentityMessageHandler(options =&gt;
            {
                options.Scopes.Add("https://api.example.com/.default");
            });
            </code>
      <para>
        <strong>Configuration from appsettings.json:</strong>
      </para>
      <code>
            // In appsettings.json:
            // {
            //   "DownstreamApi": {
            //     "Scopes": ["https://graph.microsoft.com/.default"]
            //   }
            // }
            
            services.AddHttpClient("GraphClient")
                .AddMicrosoftIdentityMessageHandler(
                    configuration.GetSection("DownstreamApi"),
                    "DownstreamApi");
            </code>
      <para>
        <strong>Parameterless for per-request configuration:</strong>
      </para>
      <code>
            services.AddHttpClient("FlexibleClient")
                .AddMicrosoftIdentityMessageHandler();
            
            // Later, in a service:
            var request = new HttpRequestMessage(HttpMethod.Get, "/api/data")
                .WithAuthenticationOptions(options =&gt;
                {
                    options.Scopes.Add("custom.scope");
                });
            var response = await httpClient.SendAsync(request);
            </code>
    </example>
    <altmember cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandler" />
  </Docs>
  <Members>
    <Member MemberName="AddMicrosoftIdentityMessageHandler">
      <MemberSignature Language="C#" Value="public static Microsoft.Extensions.DependencyInjection.IHttpClientBuilder AddMicrosoftIdentityMessageHandler (this Microsoft.Extensions.DependencyInjection.IHttpClientBuilder builder);" />
      <MemberSignature Language="ILAsm" Value=".method public static hidebysig class Microsoft.Extensions.DependencyInjection.IHttpClientBuilder AddMicrosoftIdentityMessageHandler(class Microsoft.Extensions.DependencyInjection.IHttpClientBuilder builder) cil managed" />
      <MemberSignature Language="DocId" Value="M:Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions.AddMicrosoftIdentityMessageHandler(Microsoft.Extensions.DependencyInjection.IHttpClientBuilder)" />
      <MemberSignature Language="VB.NET" Value="&lt;Extension()&gt;&#xA;Public Function AddMicrosoftIdentityMessageHandler (builder As IHttpClientBuilder) As IHttpClientBuilder" />
      <MemberSignature Language="F#" Value="static member AddMicrosoftIdentityMessageHandler : Microsoft.Extensions.DependencyInjection.IHttpClientBuilder -&gt; Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" Usage="Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions.AddMicrosoftIdentityMessageHandler builder" />
      <MemberType>Method</MemberType>
      <AssemblyInfo>
        <AssemblyName>Microsoft.Identity.Web.TokenAcquisition</AssemblyName>
        <AssemblyVersion>4.3.0.0</AssemblyVersion>
      </AssemblyInfo>
      <ReturnValue>
        <ReturnType>Microsoft.Extensions.DependencyInjection.IHttpClientBuilder</ReturnType>
      </ReturnValue>
      <Parameters>
        <Parameter Name="builder" Type="Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" RefType="this" />
      </Parameters>
      <Docs>
        <param name="builder">The <see cref="T:Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" /> to configure.</param>
        <summary>
            Adds a <see cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandler" /> to the HTTP client pipeline with no default options.
            Options must be configured per-request using <see cref="M:Microsoft.Identity.Web.HttpRequestMessageAuthenticationExtensions.WithAuthenticationOptions(System.Net.Http.HttpRequestMessage,Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions)" />.
            </summary>
        <returns>The <see cref="T:Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" /> for method chaining.</returns>
        <remarks>
          <para>
            This overload is useful when you need maximum flexibility to configure authentication options
            on a per-request basis. Since no default options are provided, every request must include
            authentication options via the <c>WithAuthenticationOptions</c> extension method.
            </para>
          <para>
            The handler will resolve <see cref="T:Microsoft.Identity.Abstractions.IAuthorizationHeaderProvider" /> from the service provider
            at runtime to acquire authorization headers for outgoing requests.
            </para>
        </remarks>
        <exception cref="T:System.ArgumentNullException">Thrown when <paramref name="builder" /> is <see langword="null" />.</exception>
        <example>
          <code>
            // Configure the HTTP client
            services.AddHttpClient("ApiClient")
                .AddMicrosoftIdentityMessageHandler();
            
            // Use the client with per-request configuration
            public class MyService
            {
                private readonly HttpClient _httpClient;
                
                public MyService(IHttpClientFactory factory)
                {
                    _httpClient = factory.CreateClient("ApiClient");
                }
                
                public async Task&lt;string&gt; GetDataAsync()
                {
                    var request = new HttpRequestMessage(HttpMethod.Get, "/api/data")
                        .WithAuthenticationOptions(options =&gt;
                        {
                            options.Scopes.Add("https://api.example.com/.default");
                        });
                    
                    var response = await _httpClient.SendAsync(request);
                    response.EnsureSuccessStatusCode();
                    return await response.Content.ReadAsStringAsync();
                }
            }
            </code>
        </example>
      </Docs>
    </Member>
    <Member MemberName="AddMicrosoftIdentityMessageHandler">
      <MemberSignature Language="C#" Value="public static Microsoft.Extensions.DependencyInjection.IHttpClientBuilder AddMicrosoftIdentityMessageHandler (this Microsoft.Extensions.DependencyInjection.IHttpClientBuilder builder, Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions options);" />
      <MemberSignature Language="ILAsm" Value=".method public static hidebysig class Microsoft.Extensions.DependencyInjection.IHttpClientBuilder AddMicrosoftIdentityMessageHandler(class Microsoft.Extensions.DependencyInjection.IHttpClientBuilder builder, class Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions options) cil managed" />
      <MemberSignature Language="DocId" Value="M:Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions.AddMicrosoftIdentityMessageHandler(Microsoft.Extensions.DependencyInjection.IHttpClientBuilder,Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions)" />
      <MemberSignature Language="VB.NET" Value="&lt;Extension()&gt;&#xA;Public Function AddMicrosoftIdentityMessageHandler (builder As IHttpClientBuilder, options As MicrosoftIdentityMessageHandlerOptions) As IHttpClientBuilder" />
      <MemberSignature Language="F#" Value="static member AddMicrosoftIdentityMessageHandler : Microsoft.Extensions.DependencyInjection.IHttpClientBuilder * Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions -&gt; Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" Usage="Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions.AddMicrosoftIdentityMessageHandler (builder, options)" />
      <MemberType>Method</MemberType>
      <AssemblyInfo>
        <AssemblyName>Microsoft.Identity.Web.TokenAcquisition</AssemblyName>
        <AssemblyVersion>4.3.0.0</AssemblyVersion>
      </AssemblyInfo>
      <ReturnValue>
        <ReturnType>Microsoft.Extensions.DependencyInjection.IHttpClientBuilder</ReturnType>
      </ReturnValue>
      <Parameters>
        <Parameter Name="builder" Type="Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" RefType="this" />
        <Parameter Name="options" Type="Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions" />
      </Parameters>
      <Docs>
        <param name="builder">The <see cref="T:Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" /> to configure.</param>
        <param name="options">The authentication options to use for all requests made by this client.</param>
        <summary>
            Adds a <see cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandler" /> to the HTTP client pipeline with the specified options.
            </summary>
        <returns>The <see cref="T:Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" /> for method chaining.</returns>
        <remarks>
          <para>
            This overload is useful when you have a pre-configured <see cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions" />
            instance that should be used for all requests made by this HTTP client. Individual requests can still
            override these default options using the per-request extension methods.
            </para>
          <para>
            The handler will resolve <see cref="T:Microsoft.Identity.Abstractions.IAuthorizationHeaderProvider" /> from the service provider
            at runtime to acquire authorization headers for outgoing requests.
            </para>
        </remarks>
        <exception cref="T:System.ArgumentNullException">
            Thrown when <paramref name="builder" /> or <paramref name="options" /> is <see langword="null" />.
            </exception>
        <example>
          <code>
            // Pre-configure options
            var options = new MicrosoftIdentityMessageHandlerOptions
            {
                Scopes = { "https://graph.microsoft.com/.default" }
            };
            options.WithAgentIdentity("agent-application-id");
            
            // Configure the HTTP client with the pre-built options
            services.AddHttpClient("GraphClient", client =&gt;
            {
                client.BaseAddress = new Uri("https://graph.microsoft.com");
            })
            .AddMicrosoftIdentityMessageHandler(options);
            
            // Use the client - authentication is automatic
            public class GraphService
            {
                private readonly HttpClient _httpClient;
                
                public GraphService(IHttpClientFactory factory)
                {
                    _httpClient = factory.CreateClient("GraphClient");
                }
                
                public async Task&lt;string&gt; GetUserProfileAsync()
                {
                    var response = await _httpClient.GetAsync("/v1.0/me");
                    response.EnsureSuccessStatusCode();
                    return await response.Content.ReadAsStringAsync();
                }
            }
            </code>
        </example>
      </Docs>
    </Member>
    <Member MemberName="AddMicrosoftIdentityMessageHandler">
      <MemberSignature Language="C#" Value="public static Microsoft.Extensions.DependencyInjection.IHttpClientBuilder AddMicrosoftIdentityMessageHandler (this Microsoft.Extensions.DependencyInjection.IHttpClientBuilder builder, Action&lt;Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions&gt; configureOptions);" />
      <MemberSignature Language="ILAsm" Value=".method public static hidebysig class Microsoft.Extensions.DependencyInjection.IHttpClientBuilder AddMicrosoftIdentityMessageHandler(class Microsoft.Extensions.DependencyInjection.IHttpClientBuilder builder, class System.Action`1&lt;class Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions&gt; configureOptions) cil managed" />
      <MemberSignature Language="DocId" Value="M:Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions.AddMicrosoftIdentityMessageHandler(Microsoft.Extensions.DependencyInjection.IHttpClientBuilder,System.Action{Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions})" />
      <MemberSignature Language="VB.NET" Value="&lt;Extension()&gt;&#xA;Public Function AddMicrosoftIdentityMessageHandler (builder As IHttpClientBuilder, configureOptions As Action(Of MicrosoftIdentityMessageHandlerOptions)) As IHttpClientBuilder" />
      <MemberSignature Language="F#" Value="static member AddMicrosoftIdentityMessageHandler : Microsoft.Extensions.DependencyInjection.IHttpClientBuilder * Action&lt;Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions&gt; -&gt; Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" Usage="Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions.AddMicrosoftIdentityMessageHandler (builder, configureOptions)" />
      <MemberType>Method</MemberType>
      <AssemblyInfo>
        <AssemblyName>Microsoft.Identity.Web.TokenAcquisition</AssemblyName>
        <AssemblyVersion>4.3.0.0</AssemblyVersion>
      </AssemblyInfo>
      <ReturnValue>
        <ReturnType>Microsoft.Extensions.DependencyInjection.IHttpClientBuilder</ReturnType>
      </ReturnValue>
      <Parameters>
        <Parameter Name="builder" Type="Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" RefType="this" />
        <Parameter Name="configureOptions" Type="System.Action&lt;Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions&gt;" />
      </Parameters>
      <Docs>
        <param name="builder">The <see cref="T:Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" /> to configure.</param>
        <param name="configureOptions">A delegate to configure the authentication options.</param>
        <summary>
            Adds a <see cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandler" /> to the HTTP client pipeline with options configured via delegate.
            </summary>
        <returns>The <see cref="T:Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" /> for method chaining.</returns>
        <remarks>
          <para>
            This overload is useful for inline configuration of authentication options. The delegate is called
            once during service configuration to create the default options for the HTTP client.
            Individual requests can still override these default options using the per-request extension methods.
            </para>
          <para>
            The handler will resolve <see cref="T:Microsoft.Identity.Abstractions.IAuthorizationHeaderProvider" /> from the service provider
            at runtime to acquire authorization headers for outgoing requests.
            </para>
        </remarks>
        <exception cref="T:System.ArgumentNullException">
            Thrown when <paramref name="builder" /> or <paramref name="configureOptions" /> is <see langword="null" />.
            </exception>
        <example>
          <code>
            // Configure the HTTP client with inline options configuration
            services.AddHttpClient("MyApiClient", client =&gt;
            {
                client.BaseAddress = new Uri("https://api.example.com");
            })
            .AddMicrosoftIdentityMessageHandler(options =&gt;
            {
                options.Scopes.Add("https://api.example.com/.default");
                options.RequestAppToken = true;
            });
            
            // Use the client - authentication is automatic
            public class ApiService
            {
                private readonly HttpClient _httpClient;
                
                public ApiService(IHttpClientFactory factory)
                {
                    _httpClient = factory.CreateClient("MyApiClient");
                }
                
                public async Task&lt;string&gt; GetDataAsync()
                {
                    var response = await _httpClient.GetAsync("/api/data");
                    response.EnsureSuccessStatusCode();
                    return await response.Content.ReadAsStringAsync();
                }
            }
            </code>
          <para>
            <strong>With agent identity:</strong>
          </para>
          <code>
            services.AddHttpClient("AgentClient")
                .AddMicrosoftIdentityMessageHandler(options =&gt;
                {
                    options.Scopes.Add("https://graph.microsoft.com/.default");
                    options.WithAgentIdentity("agent-application-id");
                    options.RequestAppToken = true;
                });
            </code>
        </example>
      </Docs>
    </Member>
    <Member MemberName="AddMicrosoftIdentityMessageHandler">
      <MemberSignature Language="C#" Value="public static Microsoft.Extensions.DependencyInjection.IHttpClientBuilder AddMicrosoftIdentityMessageHandler (this Microsoft.Extensions.DependencyInjection.IHttpClientBuilder builder, Microsoft.Extensions.Configuration.IConfiguration configuration, string sectionName);" />
      <MemberSignature Language="ILAsm" Value=".method public static hidebysig class Microsoft.Extensions.DependencyInjection.IHttpClientBuilder AddMicrosoftIdentityMessageHandler(class Microsoft.Extensions.DependencyInjection.IHttpClientBuilder builder, class Microsoft.Extensions.Configuration.IConfiguration configuration, string sectionName) cil managed" />
      <MemberSignature Language="DocId" Value="M:Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions.AddMicrosoftIdentityMessageHandler(Microsoft.Extensions.DependencyInjection.IHttpClientBuilder,Microsoft.Extensions.Configuration.IConfiguration,System.String)" />
      <MemberSignature Language="VB.NET" Value="&lt;Extension()&gt;&#xA;Public Function AddMicrosoftIdentityMessageHandler (builder As IHttpClientBuilder, configuration As IConfiguration, sectionName As String) As IHttpClientBuilder" />
      <MemberSignature Language="F#" Value="static member AddMicrosoftIdentityMessageHandler : Microsoft.Extensions.DependencyInjection.IHttpClientBuilder * Microsoft.Extensions.Configuration.IConfiguration * string -&gt; Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" Usage="Microsoft.Identity.Web.MicrosoftIdentityHttpClientBuilderExtensions.AddMicrosoftIdentityMessageHandler (builder, configuration, sectionName)" />
      <MemberType>Method</MemberType>
      <AssemblyInfo>
        <AssemblyName>Microsoft.Identity.Web.TokenAcquisition</AssemblyName>
        <AssemblyVersion>4.3.0.0</AssemblyVersion>
      </AssemblyInfo>
      <ReturnValue>
        <ReturnType>Microsoft.Extensions.DependencyInjection.IHttpClientBuilder</ReturnType>
      </ReturnValue>
      <Parameters>
        <Parameter Name="builder" Type="Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" RefType="this" />
        <Parameter Name="configuration" Type="Microsoft.Extensions.Configuration.IConfiguration" />
        <Parameter Name="sectionName" Type="System.String" />
      </Parameters>
      <Docs>
        <param name="builder">The <see cref="T:Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" /> to configure.</param>
        <param name="configuration">The configuration section containing the authentication options.</param>
        <param name="sectionName">The name of the configuration section (used for diagnostics).</param>
        <summary>
            Adds a <see cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandler" /> to the HTTP client pipeline with options bound from IConfiguration.
            </summary>
        <returns>The <see cref="T:Microsoft.Extensions.DependencyInjection.IHttpClientBuilder" /> for method chaining.</returns>
        <remarks>
          <para>
            This overload is useful when you want to configure authentication options from appsettings.json
            or other configuration sources. The configuration section is bound to a new 
            <see cref="T:Microsoft.Identity.Web.MicrosoftIdentityMessageHandlerOptions" /> instance using standard configuration binding.
            Individual requests can still override these default options using the per-request extension methods.
            </para>
          <para>
            The handler will resolve <see cref="T:Microsoft.Identity.Abstractions.IAuthorizationHeaderProvider" /> from the service provider
            at runtime to acquire authorization headers for outgoing requests.
            </para>
        </remarks>
        <exception cref="T:System.ArgumentNullException">
            Thrown when <paramref name="builder" />, <paramref name="configuration" />, or <paramref name="sectionName" /> is <see langword="null" />.
            </exception>
        <example>
          <para>
            <strong>Configuration in appsettings.json:</strong>
          </para>
          <code>
            {
              "DownstreamApi": {
                "Scopes": ["https://api.example.com/.default"]
              },
              "GraphApi": {
                "Scopes": ["https://graph.microsoft.com/.default", "User.Read"]
              }
            }
            </code>
          <para>
            <strong>Configure the HTTP client:</strong>
          </para>
          <code>
            // In Program.cs or Startup.cs
            services.AddHttpClient("DownstreamApiClient", client =&gt;
            {
                client.BaseAddress = new Uri("https://api.example.com");
            })
            .AddMicrosoftIdentityMessageHandler(
                configuration.GetSection("DownstreamApi"),
                "DownstreamApi");
            
            services.AddHttpClient("GraphClient", client =&gt;
            {
                client.BaseAddress = new Uri("https://graph.microsoft.com");
            })
            .AddMicrosoftIdentityMessageHandler(
                configuration.GetSection("GraphApi"),
                "GraphApi");
            </code>
          <para>
            <strong>Use the clients:</strong>
          </para>
          <code>
            public class MyService
            {
                private readonly HttpClient _apiClient;
                private readonly HttpClient _graphClient;
                
                public MyService(IHttpClientFactory factory)
                {
                    _apiClient = factory.CreateClient("DownstreamApiClient");
                    _graphClient = factory.CreateClient("GraphClient");
                }
                
                public async Task&lt;string&gt; GetApiDataAsync()
                {
                    var response = await _apiClient.GetAsync("/api/data");
                    response.EnsureSuccessStatusCode();
                    return await response.Content.ReadAsStringAsync();
                }
                
                public async Task&lt;string&gt; GetUserProfileAsync()
                {
                    var response = await _graphClient.GetAsync("/v1.0/me");
                    response.EnsureSuccessStatusCode();
                    return await response.Content.ReadAsStringAsync();
                }
            }
            </code>
        </example>
      </Docs>
    </Member>
  </Members>
</Type>
